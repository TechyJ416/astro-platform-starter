---
// src/pages/creators.astro
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";

const { data: creators } = await supabase
  .from('profiles')
  .select('id, full_name, username, avatar_url, bio, level, is_verified, is_premium, social_links')
  .eq('role', 'creator')
  .eq('status', 'active')
  .eq('is_active', true)
  .order('level', { ascending: false })
  .limit(24);
---

<Layout title="Creators">
  <div class="creators-page">
    <div class="page-header">
      <span class="header-label"><span class="label-line"></span> Our Community</span>
      <h1>Featured Creators</h1>
      <p>Discover talented content creators making an impact</p>
    </div>

    {creators && creators.length > 0 ? (
      <div class="creators-grid">
        {creators.map((creator, index) => (
          <a href={`/profile/${creator.id}`} class="creator-card" style={`--delay: ${index * 0.05}s`}>
            <div class="card-glow"></div>
            <div class="card-content">
              <div class="avatar-wrapper">
                {creator.avatar_url ? (
                  <img src={creator.avatar_url} alt={creator.full_name} class="avatar" />
                ) : (
                  <div class="avatar-placeholder">{creator.full_name?.charAt(0) || '?'}</div>
                )}
                {creator.is_verified && <span class="verified-badge">âœ“</span>}
                {creator.is_premium && <span class="premium-badge">â˜…</span>}
              </div>
              
              <h3 class="creator-name">{creator.full_name || 'Creator'}</h3>
              {creator.username && <span class="creator-username">@{creator.username}</span>}
              
              {creator.bio && (
                <p class="creator-bio">{creator.bio.substring(0, 80)}{creator.bio.length > 80 ? '...' : ''}</p>
              )}
              
              <div class="creator-meta">
                <span class="level-badge">Level {creator.level || 1}</span>
              </div>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="empty-state">
        <div class="empty-icon">ðŸ‘¥</div>
        <h2>No Creators Yet</h2>
        <p>Be the first to join our creator community!</p>
        <a href="/signup" class="btn btn-primary">Become a Creator</a>
      </div>
    )}
  </div>

  <style>
    .creators-page { max-width: 1200px; margin: 0 auto; padding: 2rem; }

    .page-header { text-align: center; margin-bottom: 4rem; }

    .header-label {
      display: inline-flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      font-size: 0.8125rem;
      color: var(--cosmic-blue);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      font-weight: 600;
    }

    .label-line { width: 30px; height: 1px; background: var(--cosmic-blue); }

    .page-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--star-white);
      margin-bottom: 0.5rem;
    }

    .page-header p { color: var(--star-dim); font-size: 1.125rem; }

    .creators-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.5rem;
    }

    .creator-card {
      position: relative;
      background: linear-gradient(135deg, rgba(26, 26, 46, 0.7), rgba(8, 8, 18, 0.7));
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 20px;
      padding: 1.5rem;
      text-decoration: none;
      text-align: center;
      animation: card-in 0.5s ease-out var(--delay) backwards;
      transition: all 0.4s;
    }

    @keyframes card-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .creator-card:hover {
      transform: translateY(-6px);
      border-color: rgba(79, 139, 255, 0.3);
    }

    .card-glow {
      position: absolute; inset: 0;
      background: radial-gradient(circle at center, var(--glow-blue) 0%, transparent 70%);
      opacity: 0; transition: opacity 0.4s; pointer-events: none; border-radius: 20px;
    }

    .creator-card:hover .card-glow { opacity: 0.1; }
    .card-content { position: relative; z-index: 1; }

    .avatar-wrapper { position: relative; width: 80px; height: 80px; margin: 0 auto 1rem; }

    .avatar, .avatar-placeholder {
      width: 80px; height: 80px; border-radius: 50%; object-fit: cover;
    }

    .avatar-placeholder {
      background: linear-gradient(135deg, var(--cosmic-blue), var(--cosmic-purple));
      display: flex; align-items: center; justify-content: center;
      font-size: 1.75rem; font-weight: 700; color: white;
    }

    .verified-badge, .premium-badge {
      position: absolute; bottom: 0;
      width: 22px; height: 22px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.6875rem; border: 2px solid var(--void);
    }

    .verified-badge { right: -2px; background: var(--cosmic-blue); color: white; }
    .premium-badge { left: -2px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; }

    .creator-name { font-size: 1.125rem; font-weight: 700; color: var(--star-white); margin-bottom: 0.25rem; }
    .creator-username { font-size: 0.8125rem; color: var(--cosmic-blue); display: block; margin-bottom: 0.75rem; }
    .creator-bio { font-size: 0.875rem; color: var(--star-dim); line-height: 1.5; margin-bottom: 1rem; }

    .level-badge {
      display: inline-block; padding: 0.25rem 0.75rem;
      background: rgba(79, 139, 255, 0.15); border: 1px solid rgba(79, 139, 255, 0.3);
      border-radius: 100px; font-size: 0.75rem; font-weight: 600; color: var(--cosmic-blue);
    }

    .empty-state {
      text-align: center; padding: 4rem 2rem;
      background: linear-gradient(135deg, rgba(26, 26, 46, 0.5), rgba(8, 8, 18, 0.5));
      border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 24px;
    }

    .empty-icon { font-size: 4rem; margin-bottom: 1rem; }
    .empty-state h2 { color: var(--star-white); margin-bottom: 0.5rem; }
    .empty-state p { color: var(--star-dim); margin-bottom: 1.5rem; }
  </style>
</Layout>
