---
// src/pages/admin/users.astro
export const prerender = false;

import AdminLayout from "../../layouts/AdminLayout.astro";
import { createClient } from "@supabase/supabase-js";

const isMasterKeySession = Astro.locals.isMasterKeySession || false;
const session = Astro.locals.session;

if (!isMasterKeySession && !session) {
  return Astro.redirect('/admin/login');
}

const supabase = createClient(
  import.meta.env.PUBLIC_SUPABASE_URL,
  import.meta.env.SUPABASE_SERVICE_KEY,
  { auth: { autoRefreshToken: false, persistSession: false } }
);

let successMessage = '';
let errorMessage = '';

// Level Classes (each spans 10 individual levels)
const levelClasses = [
  { class: 1, title: 'Recruit', minLevel: 1, maxLevel: 10, color: '#9CA3AF', minExp: 0 },
  { class: 2, title: 'Private', minLevel: 11, maxLevel: 20, color: '#6B7280', minExp: 1000 },
  { class: 3, title: 'Corporal', minLevel: 21, maxLevel: 30, color: '#78716C', minExp: 5000 },
  { class: 4, title: 'Sergeant', minLevel: 31, maxLevel: 40, color: '#A16207', minExp: 15000 },
  { class: 5, title: 'Lieutenant', minLevel: 41, maxLevel: 50, color: '#CA8A04', minExp: 40000 },
  { class: 6, title: 'Captain', minLevel: 51, maxLevel: 60, color: '#EAB308', minExp: 80000 },
  { class: 7, title: 'Major', minLevel: 61, maxLevel: 70, color: '#22C55E', minExp: 150000 },
  { class: 8, title: 'Colonel', minLevel: 71, maxLevel: 80, color: '#3B82F6', minExp: 300000 },
  { class: 9, title: 'General', minLevel: 81, maxLevel: 90, color: '#8B5CF6', minExp: 600000 },
  { class: 10, title: '5 Star General', minLevel: 91, maxLevel: 100, color: '#F59E0B', minExp: 1000000 },
];

function getLevelClass(level: number) {
  return levelClasses.find(c => level >= c.minLevel && level <= c.maxLevel) || levelClasses[0];
}

function getExpForLevel(level: number): number {
  // Each level requires progressively more EXP
  // Base: 100 XP for level 1, increasing by 50% each level class
  const baseExp = 100;
  const multiplier = 1.1; // 10% increase per level
  return Math.floor(baseExp * Math.pow(multiplier, level - 1));
}

function getTotalExpForLevel(level: number): number {
  let total = 0;
  for (let i = 1; i < level; i++) {
    total += getExpForLevel(i);
  }
  return total;
}

// Handle POST actions
if (Astro.request.method === 'POST') {
  const form = await Astro.request.formData();
  const action = form.get('action') as string;
  const userId = form.get('user_id') as string;

  if (action === 'update_role') {
    const newRole = form.get('role') as string;
    const { error } = await supabase
      .from('profiles')
      .update({ role: newRole })
      .eq('id', userId);
    
    if (error) errorMessage = error.message;
    else successMessage = 'User role updated!';
  }

  if (action === 'update_level') {
    const newLevel = parseInt(form.get('level') as string) || 1;
    const levelClass = getLevelClass(newLevel);
    const requiredExp = getTotalExpForLevel(newLevel);
    
    // Calculate payment multiplier based on level class
    const paymentMultipliers = [1, 1.05, 1.1, 1.2, 1.3, 1.4, 1.5, 1.7, 1.9, 2.0];
    const multiplier = paymentMultipliers[levelClass.class - 1] || 1;
    
    const { error } = await supabase
      .from('profiles')
      .update({ 
        creator_level: newLevel,
        creator_exp: requiredExp,
        payment_multiplier: multiplier
      })
      .eq('id', userId);
    
    if (error) errorMessage = error.message;
    else successMessage = `User set to Level ${newLevel} (${levelClass.title})!`;
  }

  if (action === 'update_subscription') {
    const tier = form.get('subscription_tier') as string;
    const { error } = await supabase
      .from('profiles')
      .update({ subscription_tier: tier || null })
      .eq('id', userId);
    
    if (error) errorMessage = error.message;
    else successMessage = 'Subscription updated!';
  }

  if (action === 'toggle_premium') {
    const { data: user } = await supabase.from('profiles').select('subscription_tier').eq('id', userId).single();
    const newTier = user?.subscription_tier === 'premium' ? null : 'premium';
    
    const { error } = await supabase
      .from('profiles')
      .update({ subscription_tier: newTier })
      .eq('id', userId);
    
    if (error) errorMessage = error.message;
    else successMessage = newTier ? 'Premium activated!' : 'Premium removed.';
  }

  if (action === 'add_exp') {
    const expAmount = parseInt(form.get('exp_amount') as string) || 0;
    const { data: user } = await supabase.from('profiles').select('creator_exp, creator_level').eq('id', userId).single();
    
    if (user && expAmount > 0) {
      let newExp = (user.creator_exp || 0) + expAmount;
      let newLevel = user.creator_level || 1;
      
      // Check for level ups
      while (newExp >= getTotalExpForLevel(newLevel + 1) && newLevel < 100) {
        newLevel++;
      }
      
      const levelClass = getLevelClass(newLevel);
      const paymentMultipliers = [1, 1.05, 1.1, 1.2, 1.3, 1.4, 1.5, 1.7, 1.9, 2.0];
      const multiplier = paymentMultipliers[levelClass.class - 1] || 1;

      const { error } = await supabase
        .from('profiles')
        .update({ 
          creator_exp: newExp,
          creator_level: newLevel,
          payment_multiplier: multiplier
        })
        .eq('id', userId);
      
      if (error) errorMessage = error.message;
      else successMessage = `Added ${expAmount} XP! New level: ${newLevel}`;
    }
  }

  if (action === 'ban' || action === 'unban') {
    const { error } = await supabase
      .from('profiles')
      .update({ is_banned: action === 'ban' })
      .eq('id', userId);
    
    if (error) errorMessage = error.message;
    else successMessage = `User ${action === 'ban' ? 'banned' : 'unbanned'}.`;
  }
}

// Get query params
const filter = Astro.url.searchParams.get('filter') || 'all';
const search = Astro.url.searchParams.get('search') || '';
const viewUserId = Astro.url.searchParams.get('view');

// Build query
let query = supabase
  .from('profiles')
  .select('*')
  .order('created_at', { ascending: false });

if (filter !== 'all') {
  query = query.eq('role', filter);
}

if (search) {
  query = query.or(`full_name.ilike.%${search}%,email.ilike.%${search}%,username.ilike.%${search}%`);
}

const { data: users } = await query.limit(100);

// Stats
const stats = {
  total: users?.length || 0,
  creators: users?.filter(u => u.role === 'creator').length || 0,
  managers: users?.filter(u => u.role === 'manager').length || 0,
  admins: users?.filter(u => u.role === 'admin').length || 0,
  premium: users?.filter(u => u.subscription_tier === 'premium' || u.subscription_tier === 'elite').length || 0,
};

// Single user view
let viewUser = null;
if (viewUserId) {
  const { data } = await supabase.from('profiles').select('*').eq('id', viewUserId).single();
  viewUser = data;
}
---

<AdminLayout title="Users">
  {successMessage && <div class="alert success">{successMessage}</div>}
  {errorMessage && <div class="alert error">{errorMessage}</div>}

  {viewUser ? (
    <!-- Single User View -->
    <div class="user-view">
      <div class="view-header">
        <a href="/admin/users" class="back-link">‚Üê Back to Users</a>
      </div>

      <div class="user-profile-card">
        <div class="profile-header">
          <img src={viewUser.avatar_url || `https://ui-avatars.com/api/?name=${viewUser.full_name || 'User'}&size=120`} alt="" class="avatar-xl" />
          <div class="profile-info">
            <h2>{viewUser.full_name || viewUser.username || 'Unknown User'}</h2>
            <p class="email">{viewUser.email}</p>
            <div class="badges">
              <span class={`role-badge ${viewUser.role}`}>{viewUser.role}</span>
              {viewUser.subscription_tier && (
                <span class="premium-badge">{viewUser.subscription_tier}</span>
              )}
              {viewUser.is_banned && <span class="banned-badge">BANNED</span>}
            </div>
          </div>
        </div>

        <!-- Level Section -->
        <div class="level-section">
          <h3>üéñÔ∏è Level & Rank</h3>
          
          <div class="current-level">
            <div class="level-display" style={`border-color: ${getLevelClass(viewUser.creator_level || 1).color}`}>
              <span class="level-number">{viewUser.creator_level || 1}</span>
              <span class="level-title" style={`color: ${getLevelClass(viewUser.creator_level || 1).color}`}>
                {getLevelClass(viewUser.creator_level || 1).title}
              </span>
            </div>
            <div class="level-stats">
              <div class="stat">
                <span class="label">Total EXP</span>
                <span class="value">{(viewUser.creator_exp || 0).toLocaleString()}</span>
              </div>
              <div class="stat">
                <span class="label">Payment Multiplier</span>
                <span class="value">{viewUser.payment_multiplier || 1}x</span>
              </div>
            </div>
          </div>

          <!-- Level Class Grid -->
          <div class="level-classes">
            <h4>Set Level Class</h4>
            <div class="class-grid">
              {levelClasses.map(lc => {
                const isCurrentClass = viewUser.creator_level >= lc.minLevel && viewUser.creator_level <= lc.maxLevel;
                return (
                  <form method="POST" class="class-form">
                    <input type="hidden" name="action" value="update_level" />
                    <input type="hidden" name="user_id" value={viewUser.id} />
                    <input type="hidden" name="level" value={lc.minLevel} />
                    <button 
                      type="submit" 
                      class={`class-btn ${isCurrentClass ? 'active' : ''}`}
                      style={isCurrentClass ? `background: ${lc.color}; border-color: ${lc.color}; color: white;` : `border-color: ${lc.color}; color: ${lc.color};`}
                    >
                      <span class="class-icon">üéñÔ∏è</span>
                      <span class="class-title">{lc.title}</span>
                      <span class="class-range">Lvl {lc.minLevel}-{lc.maxLevel}</span>
                    </button>
                  </form>
                );
              })}
            </div>
          </div>

          <!-- Manual Level Input -->
          <div class="manual-level">
            <h4>Set Exact Level (1-100)</h4>
            <form method="POST" class="level-form">
              <input type="hidden" name="action" value="update_level" />
              <input type="hidden" name="user_id" value={viewUser.id} />
              <input type="number" name="level" min="1" max="100" value={viewUser.creator_level || 1} class="level-input" />
              <button type="submit" class="btn btn-primary btn-sm">Set Level</button>
            </form>
          </div>

          <!-- Add EXP -->
          <div class="add-exp">
            <h4>Add Experience Points</h4>
            <form method="POST" class="exp-form">
              <input type="hidden" name="action" value="add_exp" />
              <input type="hidden" name="user_id" value={viewUser.id} />
              <div class="exp-buttons">
                <button type="submit" name="exp_amount" value="100" class="exp-btn">+100 XP</button>
                <button type="submit" name="exp_amount" value="500" class="exp-btn">+500 XP</button>
                <button type="submit" name="exp_amount" value="1000" class="exp-btn">+1,000 XP</button>
                <button type="submit" name="exp_amount" value="5000" class="exp-btn">+5,000 XP</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Role & Subscription -->
        <div class="settings-grid">
          <div class="setting-card">
            <h4>Role</h4>
            <form method="POST">
              <input type="hidden" name="action" value="update_role" />
              <input type="hidden" name="user_id" value={viewUser.id} />
              <select name="role" onchange="this.form.submit()">
                <option value="creator" selected={viewUser.role === 'creator'}>Creator</option>
                <option value="manager" selected={viewUser.role === 'manager'}>Manager</option>
                <option value="moderator" selected={viewUser.role === 'moderator'}>Moderator</option>
                <option value="admin" selected={viewUser.role === 'admin'}>Admin</option>
              </select>
            </form>
          </div>

          <div class="setting-card">
            <h4>Subscription</h4>
            <form method="POST">
              <input type="hidden" name="action" value="update_subscription" />
              <input type="hidden" name="user_id" value={viewUser.id} />
              <select name="subscription_tier" onchange="this.form.submit()">
                <option value="" selected={!viewUser.subscription_tier}>Free</option>
                <option value="premium" selected={viewUser.subscription_tier === 'premium'}>Premium</option>
                <option value="elite" selected={viewUser.subscription_tier === 'elite'}>Elite</option>
              </select>
            </form>
          </div>
        </div>

        <!-- User Stats -->
        <div class="user-stats">
          <div class="stat-item">
            <span class="label">Joined</span>
            <span class="value">{new Date(viewUser.created_at).toLocaleDateString()}</span>
          </div>
          <div class="stat-item">
            <span class="label">Total Earned</span>
            <span class="value">${(viewUser.total_earned || 0).toLocaleString()}</span>
          </div>
          <div class="stat-item">
            <span class="label">Campaigns Completed</span>
            <span class="value">{viewUser.campaigns_completed || 0}</span>
          </div>
        </div>

        <!-- Actions -->
        <div class="user-actions">
          {viewUser.is_banned ? (
            <form method="POST" class="inline">
              <input type="hidden" name="action" value="unban" />
              <input type="hidden" name="user_id" value={viewUser.id} />
              <button type="submit" class="btn btn-success">Unban User</button>
            </form>
          ) : (
            <form method="POST" class="inline">
              <input type="hidden" name="action" value="ban" />
              <input type="hidden" name="user_id" value={viewUser.id} />
              <button type="submit" class="btn btn-danger">Ban User</button>
            </form>
          )}
          <a href={`/admin/users/${viewUser.id}/activity`} class="btn btn-secondary">View Activity Log</a>
        </div>
      </div>
    </div>
  ) : (
    <!-- Users List -->
    <>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-info">
            <span class="stat-value">{stats.total}</span>
            <span class="stat-label">Total Users</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üé®</div>
          <div class="stat-info">
            <span class="stat-value">{stats.creators}</span>
            <span class="stat-label">Creators</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-info">
            <span class="stat-value">{stats.managers}</span>
            <span class="stat-label">Managers</span>
          </div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-icon">‚≠ê</div>
          <div class="stat-info">
            <span class="stat-value">{stats.premium}</span>
            <span class="stat-label">Premium</span>
          </div>
        </div>
      </div>

      <div class="toolbar">
        <form method="GET" class="search-form">
          <input type="text" name="search" placeholder="Search users..." value={search} />
          <button type="submit" class="btn btn-primary">Search</button>
        </form>
        <div class="filter-tabs">
          <a href="?filter=all" class={`tab ${filter === 'all' ? 'active' : ''}`}>All</a>
          <a href="?filter=creator" class={`tab ${filter === 'creator' ? 'active' : ''}`}>Creators</a>
          <a href="?filter=manager" class={`tab ${filter === 'manager' ? 'active' : ''}`}>Managers</a>
          <a href="?filter=admin" class={`tab ${filter === 'admin' ? 'active' : ''}`}>Admins</a>
        </div>
      </div>

      <div class="users-table">
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Level</th>
              <th>Subscription</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {users?.map(user => {
              const levelClass = getLevelClass(user.creator_level || 1);
              return (
                <tr>
                  <td>
                    <div class="user-cell">
                      <img src={user.avatar_url || `https://ui-avatars.com/api/?name=${user.full_name || 'User'}`} alt="" />
                      <div>
                        <strong>{user.full_name || user.username || 'Unknown'}</strong>
                        <span>{user.email}</span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class={`role-badge ${user.role}`}>{user.role}</span>
                  </td>
                  <td>
                    <div class="level-cell">
                      <span class="level-num" style={`color: ${levelClass.color}`}>{user.creator_level || 1}</span>
                      <span class="level-name">{levelClass.title}</span>
                    </div>
                  </td>
                  <td>
                    {user.subscription_tier ? (
                      <span class={`sub-badge ${user.subscription_tier}`}>{user.subscription_tier}</span>
                    ) : (
                      <span class="sub-badge free">Free</span>
                    )}
                  </td>
                  <td>{new Date(user.created_at).toLocaleDateString()}</td>
                  <td>
                    <a href={`?view=${user.id}`} class="btn btn-sm btn-secondary">View</a>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>
    </>
  )}

  <style>
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .stat-card { background: white; padding: 1.25rem; border-radius: 12px; display: flex; align-items: center; gap: 1rem; }
    .stat-card.highlight { background: linear-gradient(135deg, #fef3c7, #fde68a); }
    .stat-icon { font-size: 1.5rem; }
    .stat-value { display: block; font-size: 1.5rem; font-weight: 700; color: #1a1a2e; }
    .stat-label { font-size: 0.8125rem; color: #6b7280; }

    .toolbar { display: flex; justify-content: space-between; align-items: center; background: white; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
    .search-form { display: flex; gap: 0.5rem; }
    .search-form input { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; border-radius: 8px; width: 250px; }
    .filter-tabs { display: flex; gap: 0.5rem; }
    .tab { padding: 0.5rem 1rem; border-radius: 8px; text-decoration: none; color: #6b7280; font-weight: 500; }
    .tab:hover { background: #f3f4f6; }
    .tab.active { background: #2563eb; color: white; }

    .users-table { background: white; border-radius: 12px; overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    th { text-align: left; padding: 1rem; background: #f9fafb; font-weight: 600; font-size: 0.8125rem; color: #6b7280; text-transform: uppercase; }
    td { padding: 1rem; border-top: 1px solid #e5e7eb; }
    .user-cell { display: flex; align-items: center; gap: 0.75rem; }
    .user-cell img { width: 40px; height: 40px; border-radius: 50%; }
    .user-cell strong { display: block; color: #1a1a2e; }
    .user-cell span { font-size: 0.8125rem; color: #6b7280; }

    .role-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; }
    .role-badge.creator { background: #dbeafe; color: #1e40af; }
    .role-badge.manager { background: #d1fae5; color: #065f46; }
    .role-badge.admin { background: #fee2e2; color: #991b1b; }
    .role-badge.moderator { background: #ede9fe; color: #6d28d9; }

    .level-cell { display: flex; flex-direction: column; }
    .level-num { font-weight: 700; }
    .level-name { font-size: 0.75rem; color: #6b7280; }

    .sub-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 600; }
    .sub-badge.free { background: #f3f4f6; color: #6b7280; }
    .sub-badge.premium { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; }
    .sub-badge.elite { background: linear-gradient(135deg, #ec4899, #f43f5e); color: white; }

    /* User View */
    .view-header { margin-bottom: 1.5rem; }
    .back-link { color: #6b7280; text-decoration: none; }

    .user-profile-card { background: white; border-radius: 16px; padding: 2rem; }
    .profile-header { display: flex; align-items: center; gap: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb; margin-bottom: 1.5rem; }
    .avatar-xl { width: 100px; height: 100px; border-radius: 50%; }
    .profile-info h2 { margin: 0 0 0.25rem 0; }
    .profile-info .email { color: #6b7280; margin: 0 0 0.75rem 0; }
    .badges { display: flex; gap: 0.5rem; }
    .premium-badge { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; }
    .banned-badge { background: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 600; }

    /* Level Section */
    .level-section { background: #f9fafb; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
    .level-section h3 { margin: 0 0 1rem 0; font-size: 1.125rem; }
    .level-section h4 { margin: 1.5rem 0 0.75rem 0; font-size: 0.875rem; color: #6b7280; }

    .current-level { display: flex; align-items: center; gap: 2rem; margin-bottom: 1.5rem; }
    .level-display { text-align: center; padding: 1rem 2rem; border: 3px solid; border-radius: 12px; background: white; }
    .level-number { display: block; font-size: 2.5rem; font-weight: 700; color: #1a1a2e; }
    .level-title { font-size: 1rem; font-weight: 600; }
    .level-stats { display: flex; gap: 2rem; }
    .level-stats .stat .label { display: block; font-size: 0.75rem; color: #6b7280; }
    .level-stats .stat .value { font-size: 1.25rem; font-weight: 700; color: #1a1a2e; }

    .class-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem; }
    .class-btn { width: 100%; padding: 1rem 0.5rem; border: 2px solid; border-radius: 10px; background: white; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; }
    .class-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .class-btn.active { color: white !important; }
    .class-icon { font-size: 1.25rem; }
    .class-title { font-weight: 600; font-size: 0.8125rem; }
    .class-range { font-size: 0.6875rem; opacity: 0.7; }

    .level-form { display: flex; gap: 0.5rem; align-items: center; }
    .level-input { width: 80px; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 6px; text-align: center; font-weight: 600; }

    .exp-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .exp-btn { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; font-weight: 500; transition: all 0.2s; }
    .exp-btn:hover { background: #dbeafe; border-color: #3b82f6; color: #1e40af; }

    .settings-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .setting-card { background: #f9fafb; border-radius: 10px; padding: 1rem; }
    .setting-card h4 { margin: 0 0 0.5rem 0; font-size: 0.875rem; color: #6b7280; }
    .setting-card select { width: 100%; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 6px; }

    .user-stats { display: flex; gap: 2rem; padding: 1rem; background: #f9fafb; border-radius: 10px; margin-bottom: 1.5rem; }
    .stat-item .label { display: block; font-size: 0.75rem; color: #6b7280; }
    .stat-item .value { font-size: 1.125rem; font-weight: 600; color: #1a1a2e; }

    .user-actions { display: flex; gap: 0.75rem; }

    .btn { padding: 0.625rem 1.25rem; border-radius: 8px; font-weight: 600; text-decoration: none; border: none; cursor: pointer; font-size: 0.875rem; }
    .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.8125rem; }
    .btn-primary { background: #2563eb; color: white; }
    .btn-secondary { background: #f3f4f6; color: #374151; }
    .btn-success { background: #22c55e; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    .inline { display: inline; }

    .alert { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
    .alert.success { background: #d1fae5; color: #065f46; }
    .alert.error { background: #fee2e2; color: #991b1b; }

    @media (max-width: 1024px) {
      .class-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .class-grid { grid-template-columns: repeat(2, 1fr); }
      .current-level { flex-direction: column; text-align: center; }
      .settings-grid { grid-template-columns: 1fr; }
    }
  </style>
</AdminLayout>
