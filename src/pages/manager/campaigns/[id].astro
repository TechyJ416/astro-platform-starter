---
// src/pages/manager/campaigns/[id].astro
export const prerender = false;

import Layout from "../../../layouts/Layout.astro";
import { createClient } from "@supabase/supabase-js";

const session = Astro.locals.session;
const profile = Astro.locals.profile;

if (!session) {
  return Astro.redirect('/login');
}

if (profile?.role !== 'manager' && profile?.role !== 'admin') {
  return Astro.redirect('/dashboard');
}

const { id } = Astro.params;

const supabase = createClient(
  import.meta.env.PUBLIC_SUPABASE_URL,
  import.meta.env.SUPABASE_SERVICE_KEY,
  { auth: { autoRefreshToken: false, persistSession: false } }
);

let successMessage = Astro.url.searchParams.get('created') ? 'Campaign created successfully!' : '';
let errorMessage = '';

// Handle POST actions
if (Astro.request.method === 'POST') {
  const form = await Astro.request.formData();
  const action = form.get('action') as string;

  if (action === 'accept_application') {
    const appId = form.get('application_id') as string;
    const { error } = await supabase
      .from('applications')
      .update({ 
        status: 'accepted', 
        reviewed_at: new Date().toISOString(),
        reviewed_by: profile.id 
      })
      .eq('id', appId);
    
    if (error) errorMessage = error.message;
    else {
      successMessage = 'Application accepted!';
      // Create notification for creator
      const { data: app } = await supabase.from('applications').select('creator_id').eq('id', appId).single();
      if (app) {
        await supabase.from('notifications').insert({
          user_id: app.creator_id,
          type: 'application_accepted',
          title: 'Application Accepted! üéâ',
          body: 'Your application has been accepted. You can now submit content!',
          data: { campaign_id: id, application_id: appId }
        });
      }
    }
  }

  if (action === 'reject_application') {
    const appId = form.get('application_id') as string;
    const reason = form.get('reason') as string;
    const { error } = await supabase
      .from('applications')
      .update({ 
        status: 'rejected', 
        rejection_reason: reason || 'Not selected for this campaign',
        reviewed_at: new Date().toISOString(),
        reviewed_by: profile.id 
      })
      .eq('id', appId);
    
    if (error) errorMessage = error.message;
    else successMessage = 'Application rejected.';
  }

  if (action === 'approve_submission') {
    const subId = form.get('submission_id') as string;
    const { data: submission } = await supabase
      .from('submissions')
      .select('*, campaign:campaigns(payment_per_post, payout_per_post, budget_per_creator)')
      .eq('id', subId)
      .single();
    
    const paymentAmount = submission?.campaign?.payment_per_post || 
                          submission?.campaign?.payout_per_post || 
                          submission?.campaign?.budget_per_creator || 0;

    const { error } = await supabase
      .from('submissions')
      .update({ 
        status: 'approved',
        verified_at: new Date().toISOString(),
        verified_by: profile.id,
        payment_status: 'approved',
        payment_amount: paymentAmount
      })
      .eq('id', subId);
    
    if (error) errorMessage = error.message;
    else {
      successMessage = 'Submission approved!';
      // Award creator EXP
      if (submission) {
        const { data: creatorProfile } = await supabase
          .from('profiles')
          .select('creator_exp')
          .eq('id', submission.creator_id)
          .single();
        
        await supabase.from('profiles').update({
          creator_exp: (creatorProfile?.creator_exp || 0) + 50
        }).eq('id', submission.creator_id);

        await supabase.from('notifications').insert({
          user_id: submission.creator_id,
          type: 'submission_approved',
          title: 'Submission Approved! üí∞',
          body: `Your submission has been approved! Payment of $${paymentAmount} is being processed.`,
          data: { campaign_id: id, submission_id: subId }
        });
      }
    }
  }

  if (action === 'reject_submission') {
    const subId = form.get('submission_id') as string;
    const reason = form.get('reason') as string;
    const { error } = await supabase
      .from('submissions')
      .update({ 
        status: 'rejected',
        rejection_reason: reason || 'Does not meet campaign requirements',
        verified_at: new Date().toISOString(),
        verified_by: profile.id
      })
      .eq('id', subId);
    
    if (error) errorMessage = error.message;
    else successMessage = 'Submission rejected.';
  }

  if (action === 'update_status') {
    const newStatus = form.get('status') as string;
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);
    
    if (error) errorMessage = error.message;
    else successMessage = `Campaign ${newStatus}!`;
  }
}

// Load campaign with all related data
const { data: campaign, error: campaignError } = await supabase
  .from('campaigns')
  .select('*')
  .eq('id', id)
  .single();

if (campaignError || !campaign) {
  return Astro.redirect('/manager/campaigns?error=not_found');
}

// Verify ownership (managers can only see their own, admins see all)
if (profile.role === 'manager' && campaign.manager_id !== profile.id) {
  return Astro.redirect('/manager/campaigns?error=unauthorized');
}

// Load applications
const { data: applications } = await supabase
  .from('applications')
  .select(`
    *,
    creator:profiles!applications_creator_id_fkey(
      id, full_name, username, avatar_url, email,
      creator_level, creator_exp, instagram, tiktok, youtube,
      followers, follower_count
    )
  `)
  .eq('campaign_id', id)
  .order('created_at', { ascending: false });

// Load submissions
const { data: submissions } = await supabase
  .from('submissions')
  .select(`
    *,
    creator:profiles!submissions_creator_id_fkey(
      id, full_name, username, avatar_url
    ),
    captures:submission_captures(*)
  `)
  .eq('campaign_id', id)
  .order('created_at', { ascending: false });

// Calculate stats
const stats = {
  applications: {
    total: applications?.length || 0,
    pending: applications?.filter(a => a.status === 'pending').length || 0,
    accepted: applications?.filter(a => a.status === 'accepted').length || 0,
    rejected: applications?.filter(a => a.status === 'rejected').length || 0,
  },
  submissions: {
    total: submissions?.length || 0,
    pending: submissions?.filter(s => s.status === 'pending' || s.status === 'monitoring' || s.status === 'in_review').length || 0,
    approved: submissions?.filter(s => s.status === 'approved').length || 0,
    rejected: submissions?.filter(s => s.status === 'rejected').length || 0,
  },
  budget: {
    total: campaign.budget || campaign.budget_total || 0,
    perPost: campaign.payment_per_post || campaign.payout_per_post || campaign.budget_per_creator || 0,
    spent: (submissions?.filter(s => s.status === 'approved').length || 0) * 
           (campaign.payment_per_post || campaign.payout_per_post || campaign.budget_per_creator || 0),
  }
};

stats.budget.remaining = stats.budget.total - stats.budget.spent;
stats.budget.percentage = stats.budget.total > 0 ? Math.min(100, (stats.budget.spent / stats.budget.total) * 100) : 0;

const pendingApplications = applications?.filter(a => a.status === 'pending') || [];
const pendingSubmissions = submissions?.filter(s => ['pending', 'monitoring', 'in_review'].includes(s.status)) || [];

// Tab handling
const tab = Astro.url.searchParams.get('tab') || 'overview';
---

<Layout title={campaign.title}>
  <div class="campaign-detail">
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <a href="/manager/campaigns" class="back-link">‚Üê Back to Campaigns</a>
        <div class="header-top">
          <div>
            <h1>{campaign.title}</h1>
            <div class="header-meta">
              <span class={`status-badge ${campaign.status || 'draft'}`}>{campaign.status || 'draft'}</span>
              {campaign.category && <span class="category-badge">{campaign.category}</span>}
              {campaign.deadline && <span class="deadline">üìÖ Due {new Date(campaign.deadline).toLocaleDateString()}</span>}
            </div>
          </div>
          <div class="header-actions">
            {campaign.status !== 'active' && (
              <form method="POST" class="inline">
                <input type="hidden" name="action" value="update_status" />
                <input type="hidden" name="status" value="active" />
                <button type="submit" class="btn btn-success">üöÄ Launch Campaign</button>
              </form>
            )}
            {campaign.status === 'active' && (
              <form method="POST" class="inline">
                <input type="hidden" name="action" value="update_status" />
                <input type="hidden" name="status" value="paused" />
                <button type="submit" class="btn btn-warning">‚è∏Ô∏è Pause</button>
              </form>
            )}
            <a href={`/manager/campaigns/${id}/edit`} class="btn btn-secondary">‚úèÔ∏è Edit</a>
          </div>
        </div>
      </div>
    </div>

    <div class="page-content">
      {successMessage && <div class="alert success">{successMessage}</div>}
      {errorMessage && <div class="alert error">{errorMessage}</div>}

      <!-- Budget Progress -->
      <div class="budget-card">
        <div class="budget-header">
          <h3>üí∞ Budget Progress</h3>
          <span class="budget-amount">${stats.budget.spent.toLocaleString()} / ${stats.budget.total.toLocaleString()}</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style={`width: ${stats.budget.percentage}%`}></div>
        </div>
        <div class="budget-details">
          <div class="budget-stat">
            <span class="label">Per Post</span>
            <span class="value">${stats.budget.perPost}</span>
          </div>
          <div class="budget-stat">
            <span class="label">Spent</span>
            <span class="value">${stats.budget.spent.toLocaleString()}</span>
          </div>
          <div class="budget-stat">
            <span class="label">Remaining</span>
            <span class="value">${stats.budget.remaining.toLocaleString()}</span>
          </div>
          <div class="budget-stat">
            <span class="label">Approved Posts</span>
            <span class="value">{stats.submissions.approved}</span>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìù</div>
          <div class="stat-info">
            <span class="stat-value">{stats.applications.total}</span>
            <span class="stat-label">Applications</span>
          </div>
          {stats.applications.pending > 0 && (
            <span class="stat-badge pending">{stats.applications.pending} pending</span>
          )}
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-info">
            <span class="stat-value">{stats.applications.accepted}</span>
            <span class="stat-label">Accepted</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üì§</div>
          <div class="stat-info">
            <span class="stat-value">{stats.submissions.total}</span>
            <span class="stat-label">Submissions</span>
          </div>
          {stats.submissions.pending > 0 && (
            <span class="stat-badge pending">{stats.submissions.pending} to review</span>
          )}
        </div>
        <div class="stat-card">
          <div class="stat-icon">üí∞</div>
          <div class="stat-info">
            <span class="stat-value">{stats.submissions.approved}</span>
            <span class="stat-label">Approved & Paid</span>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <a href={`?tab=overview`} class:list={["tab", { active: tab === 'overview' }]}>Overview</a>
        <a href={`?tab=applications`} class:list={["tab", { active: tab === 'applications' }]}>
          Applications
          {stats.applications.pending > 0 && <span class="tab-badge">{stats.applications.pending}</span>}
        </a>
        <a href={`?tab=submissions`} class:list={["tab", { active: tab === 'submissions' }]}>
          Submissions
          {stats.submissions.pending > 0 && <span class="tab-badge">{stats.submissions.pending}</span>}
        </a>
        <a href={`?tab=creators`} class:list={["tab", { active: tab === 'creators' }]}>Creators</a>
      </div>

      <!-- Tab Content -->
      {tab === 'overview' && (
        <div class="tab-content">
          <div class="overview-grid">
            <div class="panel">
              <h3>üìã Campaign Details</h3>
              <div class="detail-row">
                <span class="label">Description</span>
                <p>{campaign.description || 'No description'}</p>
              </div>
              {campaign.requirements && (
                <div class="detail-row">
                  <span class="label">Requirements</span>
                  <p class="requirements">{campaign.requirements}</p>
                </div>
              )}
              <div class="detail-row">
                <span class="label">Content Type</span>
                <span>{campaign.content_type || 'Any'}</span>
              </div>
              <div class="detail-row">
                <span class="label">Max Creators</span>
                <span>{campaign.max_creators || 'Unlimited'}</span>
              </div>
            </div>

            <div class="panel">
              <h3>‚è≥ Pending Actions</h3>
              {pendingApplications.length === 0 && pendingSubmissions.length === 0 ? (
                <p class="empty-text">No pending actions! üéâ</p>
              ) : (
                <div class="pending-list">
                  {pendingApplications.slice(0, 3).map(app => (
                    <div class="pending-item">
                      <img src={app.creator?.avatar_url || `https://ui-avatars.com/api/?name=${app.creator?.full_name || 'User'}`} alt="" class="avatar" />
                      <div class="pending-info">
                        <span class="name">{app.creator?.full_name || app.creator?.username}</span>
                        <span class="type">Application</span>
                      </div>
                      <a href={`?tab=applications`} class="btn btn-sm btn-primary">Review</a>
                    </div>
                  ))}
                  {pendingSubmissions.slice(0, 3).map(sub => (
                    <div class="pending-item">
                      <img src={sub.creator?.avatar_url || `https://ui-avatars.com/api/?name=${sub.creator?.full_name || 'User'}`} alt="" class="avatar" />
                      <div class="pending-info">
                        <span class="name">{sub.creator?.full_name || sub.creator?.username}</span>
                        <span class="type">Submission</span>
                      </div>
                      <a href={`?tab=submissions`} class="btn btn-sm btn-primary">Review</a>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {tab === 'applications' && (
        <div class="tab-content">
          {applications && applications.length > 0 ? (
            <div class="applications-list">
              {applications.map(app => (
                <div class={`application-card ${app.status}`}>
                  <div class="applicant-info">
                    <img src={app.creator?.avatar_url || `https://ui-avatars.com/api/?name=${app.creator?.full_name || 'User'}`} alt="" class="avatar-lg" />
                    <div class="applicant-details">
                      <h4>{app.creator?.full_name || app.creator?.username || 'Unknown'}</h4>
                      <div class="applicant-meta">
                        {app.creator?.creator_level && (
                          <span class="level">Level {app.creator.creator_level}</span>
                        )}
                        {(app.creator?.followers || app.creator?.follower_count) && (
                          <span class="followers">
                            {((app.creator.followers || app.creator.follower_count) / 1000).toFixed(1)}K followers
                          </span>
                        )}
                        <span class="email">{app.creator?.email}</span>
                      </div>
                      <div class="social-links">
                        {app.creator?.instagram && <a href={`https://instagram.com/${app.creator.instagram}`} target="_blank">üì∏ IG</a>}
                        {app.creator?.tiktok && <a href={`https://tiktok.com/@${app.creator.tiktok}`} target="_blank">üéµ TT</a>}
                        {app.creator?.youtube && <a href={`https://youtube.com/${app.creator.youtube}`} target="_blank">üì∫ YT</a>}
                      </div>
                    </div>
                  </div>
                  
                  {app.pitch && (
                    <div class="pitch">
                      <strong>Pitch:</strong> {app.pitch}
                    </div>
                  )}
                  
                  {app.proposed_rate && (
                    <div class="proposed-rate">
                      <strong>Proposed Rate:</strong> ${app.proposed_rate}
                    </div>
                  )}

                  <div class="application-footer">
                    <span class="date">Applied {new Date(app.created_at).toLocaleDateString()}</span>
                    <span class={`status-badge ${app.status}`}>{app.status}</span>
                  </div>

                  {app.status === 'pending' && (
                    <div class="action-buttons">
                      <form method="POST" class="inline">
                        <input type="hidden" name="action" value="accept_application" />
                        <input type="hidden" name="application_id" value={app.id} />
                        <button type="submit" class="btn btn-success">‚úì Accept</button>
                      </form>
                      <form method="POST" class="inline reject-form">
                        <input type="hidden" name="action" value="reject_application" />
                        <input type="hidden" name="application_id" value={app.id} />
                        <input type="text" name="reason" placeholder="Reason (optional)" class="reason-input" />
                        <button type="submit" class="btn btn-danger">‚úó Reject</button>
                      </form>
                    </div>
                  )}

                  {app.status === 'rejected' && app.rejection_reason && (
                    <div class="rejection-reason">
                      <strong>Reason:</strong> {app.rejection_reason}
                    </div>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <div class="empty-state">
              <span class="empty-icon">üìù</span>
              <h3>No Applications Yet</h3>
              <p>Share your campaign to start receiving applications from creators.</p>
            </div>
          )}
        </div>
      )}

      {tab === 'submissions' && (
        <div class="tab-content">
          {submissions && submissions.length > 0 ? (
            <div class="submissions-grid">
              {submissions.map(sub => (
                <div class={`submission-card ${sub.status}`}>
                  <div class="submission-header">
                    <img src={sub.creator?.avatar_url || `https://ui-avatars.com/api/?name=${sub.creator?.full_name || 'User'}`} alt="" class="avatar" />
                    <div>
                      <h4>{sub.creator?.full_name || sub.creator?.username}</h4>
                      <span class="platform-badge">{sub.platform}</span>
                    </div>
                    <span class={`status-badge ${sub.status}`}>{sub.status}</span>
                  </div>

                  <a href={sub.url} target="_blank" class="submission-link">
                    üîó {sub.url.substring(0, 50)}...
                  </a>

                  {sub.captures && sub.captures.length > 0 && (
                    <div class="screenshot-preview">
                      <img src={sub.captures[0].screenshot_url} alt="Screenshot" />
                    </div>
                  )}

                  <div class="submission-stats">
                    {sub.latest_views > 0 && <span>üëÅÔ∏è {sub.latest_views.toLocaleString()}</span>}
                    {sub.latest_likes > 0 && <span>‚ù§Ô∏è {sub.latest_likes.toLocaleString()}</span>}
                    {sub.latest_comments > 0 && <span>üí¨ {sub.latest_comments}</span>}
                  </div>

                  <div class="submission-footer">
                    <span class="date">{new Date(sub.created_at).toLocaleDateString()}</span>
                    {sub.payment_amount && sub.status === 'approved' && (
                      <span class="payment">üí∞ ${sub.payment_amount}</span>
                    )}
                  </div>

                  {['pending', 'monitoring', 'in_review'].includes(sub.status) && (
                    <div class="action-buttons">
                      <form method="POST" class="inline">
                        <input type="hidden" name="action" value="approve_submission" />
                        <input type="hidden" name="submission_id" value={sub.id} />
                        <button type="submit" class="btn btn-success">‚úì Approve</button>
                      </form>
                      <form method="POST" class="inline reject-form">
                        <input type="hidden" name="action" value="reject_submission" />
                        <input type="hidden" name="submission_id" value={sub.id} />
                        <input type="text" name="reason" placeholder="Reason" class="reason-input" />
                        <button type="submit" class="btn btn-danger">‚úó Reject</button>
                      </form>
                    </div>
                  )}

                  {sub.status === 'rejected' && sub.rejection_reason && (
                    <div class="rejection-reason">
                      <strong>Reason:</strong> {sub.rejection_reason}
                    </div>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <div class="empty-state">
              <span class="empty-icon">üì§</span>
              <h3>No Submissions Yet</h3>
              <p>Accepted creators will submit their content here.</p>
            </div>
          )}
        </div>
      )}

      {tab === 'creators' && (
        <div class="tab-content">
          {applications?.filter(a => a.status === 'accepted').length > 0 ? (
            <div class="creators-grid">
              {applications.filter(a => a.status === 'accepted').map(app => {
                const creatorSubmissions = submissions?.filter(s => s.creator_id === app.creator_id) || [];
                const approved = creatorSubmissions.filter(s => s.status === 'approved').length;
                const pending = creatorSubmissions.filter(s => ['pending', 'monitoring', 'in_review'].includes(s.status)).length;
                
                return (
                  <div class="creator-card">
                    <img src={app.creator?.avatar_url || `https://ui-avatars.com/api/?name=${app.creator?.full_name || 'User'}`} alt="" class="avatar-lg" />
                    <h4>{app.creator?.full_name || app.creator?.username}</h4>
                    {app.creator?.creator_level && (
                      <span class="level-badge">Level {app.creator.creator_level}</span>
                    )}
                    <div class="creator-stats">
                      <div class="stat">
                        <span class="value">{creatorSubmissions.length}</span>
                        <span class="label">Submissions</span>
                      </div>
                      <div class="stat">
                        <span class="value">{approved}</span>
                        <span class="label">Approved</span>
                      </div>
                      <div class="stat">
                        <span class="value">{pending}</span>
                        <span class="label">Pending</span>
                      </div>
                    </div>
                    <a href={`/manager/creators/${app.creator_id}`} class="btn btn-secondary btn-sm">View Profile</a>
                  </div>
                );
              })}
            </div>
          ) : (
            <div class="empty-state">
              <span class="empty-icon">üë•</span>
              <h3>No Accepted Creators</h3>
              <p>Accept applications to see creators here.</p>
            </div>
          )}
        </div>
      )}
    </div>
  </div>

  <style>
    .campaign-detail { min-height: 100vh; background: #f8fafc; }
    
    .page-header { background: linear-gradient(135deg, #1a1a2e 0%, #2d2d4a 100%); padding: 2rem 0; }
    .header-content { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
    .back-link { color: rgba(255,255,255,0.7); text-decoration: none; font-size: 0.875rem; }
    .header-top { display: flex; justify-content: space-between; align-items: start; margin-top: 1rem; gap: 1rem; flex-wrap: wrap; }
    .page-header h1 { font-size: 1.75rem; color: white; margin: 0 0 0.5rem 0; }
    .header-meta { display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; }
    .header-actions { display: flex; gap: 0.5rem; }
    
    .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
    .status-badge.draft { background: rgba(255,255,255,0.2); color: white; }
    .status-badge.active { background: #22c55e; color: white; }
    .status-badge.paused { background: #f59e0b; color: white; }
    .status-badge.completed { background: #3b82f6; color: white; }
    .status-badge.pending { background: #fef3c7; color: #92400e; }
    .status-badge.accepted { background: #d1fae5; color: #065f46; }
    .status-badge.rejected { background: #fee2e2; color: #991b1b; }
    .status-badge.approved { background: #d1fae5; color: #065f46; }
    .status-badge.monitoring { background: #dbeafe; color: #1e40af; }
    .status-badge.in_review { background: #fef3c7; color: #92400e; }
    
    .category-badge { background: rgba(255,255,255,0.15); color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; }
    .deadline { color: rgba(255,255,255,0.8); font-size: 0.875rem; }
    
    .page-content { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem; }
    
    .alert { padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; }
    .alert.success { background: #d1fae5; color: #065f46; }
    .alert.error { background: #fee2e2; color: #991b1b; }
    
    /* Budget Card */
    .budget-card { background: white; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .budget-header h3 { margin: 0; font-size: 1rem; color: #1a1a2e; }
    .budget-amount { font-size: 1.25rem; font-weight: 700; color: #1a1a2e; }
    .progress-bar { height: 12px; background: #e5e7eb; border-radius: 6px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #16a34a); border-radius: 6px; transition: width 0.5s ease; }
    .budget-details { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; }
    .budget-stat { text-align: center; }
    .budget-stat .label { display: block; font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem; }
    .budget-stat .value { display: block; font-size: 1.125rem; font-weight: 600; color: #1a1a2e; }
    
    /* Stats Grid */
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .stat-card { background: white; padding: 1.25rem; border-radius: 12px; display: flex; align-items: center; gap: 1rem; position: relative; }
    .stat-icon { font-size: 1.5rem; width: 48px; height: 48px; background: #f3f4f6; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
    .stat-info { flex: 1; }
    .stat-value { display: block; font-size: 1.5rem; font-weight: 700; color: #1a1a2e; }
    .stat-label { font-size: 0.8125rem; color: #6b7280; }
    .stat-badge { position: absolute; top: 0.75rem; right: 0.75rem; background: #fef3c7; color: #92400e; padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 600; }
    
    /* Tabs */
    .tabs { display: flex; gap: 0.5rem; background: white; padding: 0.5rem; border-radius: 12px; margin-bottom: 1.5rem; }
    .tab { padding: 0.75rem 1.25rem; border-radius: 8px; text-decoration: none; color: #6b7280; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; }
    .tab:hover { background: #f3f4f6; }
    .tab.active { background: #2563eb; color: white; }
    .tab-badge { background: rgba(255,255,255,0.3); padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; }
    .tab:not(.active) .tab-badge { background: #fee2e2; color: #991b1b; }
    
    /* Panels */
    .panel { background: white; border-radius: 12px; padding: 1.5rem; }
    .panel h3 { margin: 0 0 1rem 0; font-size: 1rem; color: #1a1a2e; }
    
    .overview-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    .detail-row { margin-bottom: 1rem; }
    .detail-row:last-child { margin-bottom: 0; }
    .detail-row .label { display: block; font-size: 0.75rem; font-weight: 600; color: #6b7280; text-transform: uppercase; margin-bottom: 0.25rem; }
    .detail-row p { margin: 0; color: #374151; }
    .requirements { white-space: pre-line; }
    
    .empty-text { color: #6b7280; text-align: center; padding: 2rem; }
    
    .pending-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .pending-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: #f9fafb; border-radius: 8px; }
    .pending-info { flex: 1; }
    .pending-info .name { display: block; font-weight: 500; color: #1a1a2e; }
    .pending-info .type { font-size: 0.75rem; color: #6b7280; }
    
    /* Applications */
    .applications-list { display: flex; flex-direction: column; gap: 1rem; }
    .application-card { background: white; border-radius: 12px; padding: 1.5rem; border-left: 4px solid #e5e7eb; }
    .application-card.pending { border-left-color: #f59e0b; }
    .application-card.accepted { border-left-color: #22c55e; }
    .application-card.rejected { border-left-color: #ef4444; }
    
    .applicant-info { display: flex; gap: 1rem; margin-bottom: 1rem; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
    .avatar-lg { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; }
    .applicant-details h4 { margin: 0 0 0.25rem 0; color: #1a1a2e; }
    .applicant-meta { display: flex; gap: 1rem; font-size: 0.8125rem; color: #6b7280; flex-wrap: wrap; }
    .applicant-meta .level { background: #dbeafe; color: #1e40af; padding: 0.125rem 0.5rem; border-radius: 4px; }
    .social-links { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
    .social-links a { font-size: 0.75rem; color: #6b7280; text-decoration: none; }
    .social-links a:hover { color: #2563eb; }
    
    .pitch, .proposed-rate { background: #f9fafb; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.875rem; }
    
    .application-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #e5e7eb; }
    .date { font-size: 0.8125rem; color: #6b7280; }
    
    .action-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; align-items: center; flex-wrap: wrap; }
    .reject-form { display: flex; gap: 0.5rem; align-items: center; }
    .reason-input { padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; width: 200px; }
    
    .rejection-reason { background: #fee2e2; color: #991b1b; padding: 0.75rem; border-radius: 8px; margin-top: 1rem; font-size: 0.875rem; }
    
    /* Submissions */
    .submissions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem; }
    .submission-card { background: white; border-radius: 12px; padding: 1.25rem; border-left: 4px solid #e5e7eb; }
    .submission-card.pending, .submission-card.monitoring, .submission-card.in_review { border-left-color: #f59e0b; }
    .submission-card.approved { border-left-color: #22c55e; }
    .submission-card.rejected { border-left-color: #ef4444; }
    
    .submission-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
    .submission-header h4 { margin: 0; font-size: 0.9375rem; }
    .submission-header .status-badge { margin-left: auto; }
    .platform-badge { background: #f3f4f6; color: #374151; padding: 0.125rem 0.5rem; border-radius: 4px; font-size: 0.6875rem; text-transform: uppercase; }
    
    .submission-link { display: block; color: #2563eb; font-size: 0.875rem; margin-bottom: 1rem; word-break: break-all; }
    
    .screenshot-preview { margin-bottom: 1rem; border-radius: 8px; overflow: hidden; background: #f3f4f6; }
    .screenshot-preview img { width: 100%; height: 150px; object-fit: cover; }
    
    .submission-stats { display: flex; gap: 1rem; font-size: 0.8125rem; color: #6b7280; margin-bottom: 1rem; }
    
    .submission-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 0.75rem; border-top: 1px solid #e5e7eb; }
    .payment { color: #059669; font-weight: 600; }
    
    /* Creators */
    .creators-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
    .creator-card { background: white; border-radius: 12px; padding: 1.5rem; text-align: center; }
    .creator-card .avatar-lg { margin-bottom: 0.75rem; }
    .creator-card h4 { margin: 0 0 0.5rem 0; }
    .level-badge { background: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
    .creator-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin: 1rem 0; padding: 1rem 0; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; }
    .creator-stats .stat { text-align: center; }
    .creator-stats .value { display: block; font-weight: 700; color: #1a1a2e; }
    .creator-stats .label { font-size: 0.6875rem; color: #6b7280; }
    
    /* Empty State */
    .empty-state { text-align: center; padding: 4rem 2rem; background: white; border-radius: 12px; }
    .empty-icon { font-size: 3rem; display: block; margin-bottom: 1rem; }
    .empty-state h3 { margin: 0 0 0.5rem 0; color: #1a1a2e; }
    .empty-state p { color: #6b7280; margin: 0; }
    
    /* Buttons */
    .btn { padding: 0.625rem 1.25rem; border-radius: 8px; font-weight: 600; text-decoration: none; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; }
    .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.8125rem; }
    .btn-primary { background: #2563eb; color: white; }
    .btn-secondary { background: #f3f4f6; color: #374151; }
    .btn-success { background: #22c55e; color: white; }
    .btn-warning { background: #f59e0b; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    
    .inline { display: inline; }
    
    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .overview-grid { grid-template-columns: 1fr; }
      .budget-details { grid-template-columns: repeat(2, 1fr); }
      .header-top { flex-direction: column; }
      .tabs { flex-wrap: wrap; }
    }
  </style>
</Layout>
